<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	</head>
	<body style="margin:0px;"">

		<div id="map" style="width:100%; height:100%;"></div>
		<script type="text/javascript">

			const urlParams = new URLSearchParams(window.location.search);
			var map = L.map('map').setView([-23.57258478690228, -46.70324007434706], 13);
			var user = urlParams.get('user');
			var baseUrl = window.location.origin;
			var timeout = 2000;
			var marker = null;

			L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {}).addTo(map);

			// var popup = L.popup()
			// 	.setLatLng([-22.296116898750796, -48.57711990408085])
			// 	.setContent('<p><strong>Nome:</strong> Arthur</p><p><strong>Tipo Sangu√≠neo:</strong> A+</p>')
			// 	.openOn(map)
			// ;

			var myLooping = function () {

				const xhr = new XMLHttpRequest();
				xhr.open("GET", baseUrl + '/get-info?user='+ user);
				xhr.send();
				xhr.responseType = "json";
				xhr.onload = () => {

					if (xhr.readyState != 4 || xhr.status != 200)
						return;

					var response = xhr.response;

					if (marker == null)
						marker = L.marker([response.lat, response.lng], {title:user, alt:user}).addTo(map);

					marker.setLatLng([response.lat, response.lng]);
					map.setView([response.lat, response.lng],12);

					setTimeout(myLooping, timeout);
					
				};

			};

			if (user != '' && user != null)
			{
				myLooping();
			}

		</script>

	</body>
</html>